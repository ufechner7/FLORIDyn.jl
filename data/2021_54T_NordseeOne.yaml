# FLORIDyn project configuration
#
# Flow conditions
# Choose the input files for wind velocity, direction and ambient turbulence intensity as well as shear.
wind:
  # Velocity Input
  # - I_and_I       uses the Immersion and Invariance effective wind speed estimator based on SOWFA data. 
  # - Interpolation linearly interpolates between set-points, the value is equally used for all turbines.
  # - Interpolation_wErrorCov Same as above, but with error covariance. 
  # - InterpTurbine also linearly interpolates between set-points, but individually for every turbine. 
  # - InterpTurbine_wErrorCov Same as above, but with error covariance.
  # - Constant      provides a constant velocity for all turbines.
  # - Constant_wErrorCov      Same as above, but with error covariance.
  # - EnKF_InterpTurbine
  # - RW_with_Mean  random walk with mean
  # - ZOH_wErrorCov
  input_vel: Constant

  # Wind Direction Input
  # - Constant
  # - Constant_wErrorCov
  # - Interpolation
  # - Interpolation_wErrorCov
  # - InterpTurbine
  # - InterpTurbine_wErrorCov
  # - RW_with_mean             random walk with mean
  input_dir: Interpolation
  # Ambient Turbulence Intensity Input
  # - Interpolation
  # - InterpTurbine (Interpolation per turbine)
  # - Constant
  input_ti: Constant
  # Wind Shear Input
  #   For the custom wind profile the reduction is interpolated between given set-points, this option 
  #   is called Interpolate and expects input normalized by hub-height and wind speed at hub-height.
  # - PowerLaw
  # - Interpolate
  input_shear: PowerLaw
  # State Correction
  #   Choose how flow metrics are corrected in the simulation based on measurements of the turbines or 
  #   of the states in the OPs.
  #   The option Influence makes turbines in the wake of other turbines copy the state of the OPs of the 
  #   upstream turbines. Uninfluenced turbines will use the flow measures as provided by the selected input method. 
  #   With the option None the values from the inputs are put into the OPs and existing OPs keep their unaltered state.
  correction:
    # Option for velocity correction
    # - None
    # - Influence
    vel: None
    # Option for wind direction correction
    #   For the wind direction All is also an option, meaning that all OPs will be assigned the same wind direction. 
    #   The value is based on the first returned value of the wind direction input.
    # - None
    # - Influence
    dir: All
    # Option for turbulence intensity correction
    # - None
    # - Influence
    ti: None
  # Wind Field state pertubation / process noise
  #   To model a changing and evolving wind field, state pertubation can be activated. 
  #   This adds a normal distributed pertubation to all states with a given standard deviation .
  perturbation:
    vel: 0
    vel_sigma: 0.2
    dir: 0
    dir_sigma: 0.5
    ti: 0
    ti_sigma: 0.005

sim:
  # the used FLORIS model; currently, only 'gaussian' is supported
  floris: gaussian
  # start & end time of the simulation and the time resolution. 
  start_time: 20000       # [s]
  end_time: 21200         # [s]
  time_step: 4            # [s]

  # The discretization method, 'sunflower' or 'isocell'. The latter provides a regular grid 
  # with equal sized cells. This is the favoured method! Downside is that the number of cells
  # can not be chosen freely, the algorithm might correct the requested number of cells to 
  # the nearest possible number (3, 12, 27, 48, 75, 108, 147, ...).  
  # Sunflower distributes based on an outgoing spiral, the number of cells can be freely chosen.
  rotor_discret: isocell
  rotor_points: 50 # number of points for the discretization of the rotor disk
  
  # Dynamic settings
  dyn:
    # Advection speed
    # Multiplier of the travel speed of the OPs with their own wind speed. 
    # The published FLORIDyn models used 1, other literature suggests values as low as 0.6.
    advection: 1
    advection_mod: linear
    # Operating point (OP) / wind field propagation
    # 'Basic'    iterates the OPs based on their wind speed, OPs do not interact with each other. 
    # 'Averaged' is a weighted average between the new wind speed value and the old value. 
    #            This smooths out turbulent inputs and reduces the occasions when one OP overtakes another OP. 
    # 'Maximum'  overwrites the state of a slower OP once the faster one overtakes it.
    op_iteration: IterateOPs_basic
    # In case the averaging is used, provide weights for the new value (first weight) 
    # and the old value (second value). They have to sum up to 1.
    op_iter_weights: [0.7, 0.3]
    vel:
      # Spacial-Time-Averaged weight settings for the wind speed
      #   Lejeune: 512 63 126
      #   Becker Energies: 256 126 256
      #   Becker CLC: 256 256 50
      iter_sigma_dw: 256
      iter_sigma_cw: 256
      iter_sigma_time: 50
    dir:
      # Spacial-Time-Averaged weight settings for the wind direction
      iter_sigma_dw: 512
      iter_sigma_cw: 512
      iter_sigma_time: 50
  # Choose if simulation should be initialized, an initialized state should be loaded 
  # or should be started without initialization.
  init: noinit # 'noinit' or 'load' (load requires initT.jld2)
  path_to_data: "data/2021_54T_NordseeOne"
  save_init_state: false  # if true, stores T_init.jld2
  save_final_state: false # if true, stores T_final.jld2

# Controller
# Currently only the yaw angle can be set, the axial induction factor is always set to 1/3.
# - 'Interpolate' per turbine reads an orientation file 'Control_YawInterpolation.csv' 
#                 to interpolate the turbines world orientation between different set-points. 
# - SOWFA         reads the file 'SOWFA_nacelleYaw.csv' which is directly the renamed file
#                 from a SOWFA simulation. 
# - Constant      reads a single orientation and applies it to all turbines at all times.
con:
  yaw: SOWFA

floris:
  alpha: 2.32
  beta: 0.154
  k_a: 0.3837
  k_b: 0.0037
  k_fa: 0.73
  k_fb: 0.8325
  k_fc: 0.0325
  k_fd: -0.32
  eta: 1
  p_p: 2.2
  airDen: 1.225 # kg/m^3 (SOWFA)
  TIexp: 3 # TI crosswind distribution is modelled as a factor of sigma_y and sigma_z.
           # This is in contrast to previous literature which assumed a fixed box area and the
           # turbines therein as source of higher TI.

floridyn:
  n_op: 400
  deltaUW: 10.0
  deltaDW: 0.5
  deltaCW: 3.0
  dynStateChange: "None"
  twf_model: "heterogeneous"

turbines:
    - id: 1 
      type: DTU 10MW 
      x: 2524 
      y: 5303 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 2 
      type: DTU 10MW 
      x: 5217 
      y: 5396 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 3 
      type: DTU 10MW 
      x: 6601 
      y: 5041 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 4 
      type: DTU 10MW 
      x: 7610 
      y: 5097 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 5 
      type: DTU 10MW 
      x: 8620 
      y: 5097 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 6 
      type: DTU 10MW 
      x: 9630 
      y: 5172 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 7 
      type: DTU 10MW 
      x: 10621 
      y: 5284 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 8 
      type: DTU 10MW 
      x: 11631 
      y: 5396 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 9 
      type: DTU 10MW 
      x: 804 
      y: 4704 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 10 
      type: DTU 10MW 
      x: 748 
      y: 3900 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 11 
      type: DTU 10MW 
      x: 729 
      y: 2647 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 12 
      type: DTU 10MW 
      x: 710 
      y: 1862 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 13 
      type: DTU 10MW 
      x: 654 
      y: 1058 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 14 
      type: DTU 10MW 
      x: 1739 
      y: 1189 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 15 
      type: DTU 10MW 
      x: 2767 
      y: 1245 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 16 
      type: DTU 10MW 
      x: 3758 
      y: 1638 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 17 
      type: DTU 10MW 
      x: 2599 
      y: 2049 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 18 
      type: DTU 10MW 
      x: 1645 
      y: 2311 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 19 
      type: DTU 10MW 
      x: 1645 
      y: 3601 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 20 
      type: DTU 10MW 
      x: 1664 
      y: 4630 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 21 
      type: DTU 10MW 
      x: 2599 
      y: 4349 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 22 
      type: DTU 10MW 
      x: 2524 
      y: 3302 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 23 
      type: DTU 10MW 
      x: 3459 
      y: 2984 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 24 
      type: DTU 10MW 
      x: 4338 
      y: 2647 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 25 
      type: DTU 10MW 
      x: 5254 
      y: 2404 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 26 
      type: DTU 10MW 
      x: 6114 
      y: 2086 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 27 
      type: DTU 10MW 
      x: 7274 
      y: 2143 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 28 
      type: DTU 10MW 
      x: 8284 
      y: 2273 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 29 
      type: DTU 10MW 
      x: 9106 
      y: 1843 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 30 
      type: DTU 10MW 
      x: 10172 
      y: 2068 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 31 
      type: DTU 10MW 
      x: 11220 
      y: 2311 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 32 
      type: DTU 10MW 
      x: 12285 
      y: 2573 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 33 
      type: DTU 10MW 
      x: 13277 
      y: 2797 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 34 
      type: DTU 10MW 
      x: 12603 
      y: 3639 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 35 
      type: DTU 10MW 
      x: 12622 
      y: 4592 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 36 
      type: DTU 10MW 
      x: 11668 
      y: 4387 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 37 
      type: DTU 10MW 
      x: 11594 
      y: 3395 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 38 
      type: DTU 10MW 
      x: 10602 
      y: 3152 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 39 
      type: DTU 10MW 
      x: 10602 
      y: 4143 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 40 
      type: DTU 10MW 
      x: 12659 
      y: 5639 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 41 
      type: DTU 10MW 
      x: 9630 
      y: 3395 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 42 
      type: DTU 10MW 
      x: 8676 
      y: 4349 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 43 
      type: DTU 10MW 
      x: 8415 
      y: 3208 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 44 
      type: DTU 10MW 
      x: 7442 
      y: 3171 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 45 
      type: DTU 10MW 
      x: 6395 
      y: 3078 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 46 
      type: DTU 10MW 
      x: 5310 
      y: 3395 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 47 
      type: DTU 10MW 
      x: 6152 
      y: 4069 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 48 
      type: DTU 10MW 
      x: 7199 
      y: 4087 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 49 
      type: DTU 10MW 
      x: 5236 
      y: 4368 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 50 
      type: DTU 10MW 
      x: 4357 
      y: 4667 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 51 
      type: DTU 10MW 
      x: 3440 
      y: 4985 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 52 
      type: DTU 10MW 
      x: 3459 
      y: 3994 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 53 
      type: DTU 10MW 
      x: 4357 
      y: 3676 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
    - id: 54 
      type: DTU 10MW 
      x: 822 
      y: 5490 
      z: 0
      a: 0.33
      yaw: 0
      ti: 0.06
