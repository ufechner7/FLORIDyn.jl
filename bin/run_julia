#!/bin/bash -eu
# Copyright (c) 2025 Uwe Fechner
# SPDX-License-Identifier: BSD-3-Clause

# Start script for normal use of FLORIDyn

# Install TerminalPager and Timers and Revise and ControlPlots globally, if not yet installed
julia -e 'using Pkg;
globaldependencies() = keys(Pkg.project().dependencies)
if ! ("TerminalPager" in globaldependencies()); Pkg.add("TerminalPager"); end;
if ! ("Timers" in globaldependencies()); Pkg.add("Timers"); end;
if ! ("Revise" in globaldependencies()); Pkg.add("Revise"); end;
if ! ("ControlPlots" in globaldependencies()); Pkg.add("ControlPlots"); end;'

# Run Julia with 8 threads and load FLORIdyn
# In addition, define the function menu()
julia --project -t 8 --gcthreads=4,1 -i -e 'using FLORIDyn; function menu(); include("examples/menu.jl"); end'

# ON DESKTOP
# 163s for 300 iterations with 8 threads with default GC on Ryzen 7 7850X 2.7x advantage
# 277s with plt.GC(false) and plt.GC(true) around the multithreaded loop
# 460s for 300 iterations with 1 thread on Ryzen 7 7850X
# 1.18s single threaded
# 0.51s multithreaded # was: 0.27

# ON LAPTOP, performance mode
# 309s on laptop multithreaded 2.1x advantage
# 654s on laptop single threaded 
# 1.50s single threaded
# 0.56s multithreaded
